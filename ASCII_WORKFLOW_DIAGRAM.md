# ASCII Workflow Diagram - AI Hypnosis Generator

## Complete System Flow

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           USER INTERACTION LAYER                             │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                               │
│  ┌──────────┐    ┌──────────┐    ┌───────────┐    ┌──────────┐            │
│  │ Landing  │───▶│ Register │───▶│ Onboarding│───▶│  Create  │            │
│  │   Page   │    │  /Login  │    │  (20 Qs)  │    │ Journey  │            │
│  └──────────┘    └──────────┘    └───────────┘    └─────┬────┘            │
│                                                            │                  │
│                                                            ▼                  │
│                                                    ┌───────────────┐         │
│                                                    │   Loading     │         │
│                                                    │   Screen      │         │
│                                                    │  (5-10 min)   │         │
│                                                    └───────┬───────┘         │
│                                                            │                  │
│                                                            ▼                  │
│  ┌─────────────────────────────────────────────────────────────────┐        │
│  │                       DASHBOARD                                  │        │
│  │  ┌─────────┐  ┌─────────┐  ┌──────┐  ┌─────────┐  ┌────────┐ │        │
│  │  │ Journey │  │ Profile │  │ Stats│  │ Journal │  │Settings│ │        │
│  │  │ (7 days)│  │  Info   │  │      │  │ Entries │  │        │ │        │
│  │  └─────────┘  └─────────┘  └──────┘  └─────────┘  └────────┘ │        │
│  └─────────────────────────────────────────────────────────────────┘        │
│                                                                               │
└───────────────────────────────────┬───────────────────────────────────────┘
                                    │
                                    │ HTTPS/REST API
                                    │
┌───────────────────────────────────▼───────────────────────────────────────┐
│                          BACKEND API LAYER (Railway)                        │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                               │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  │
│  │     Auth     │  │   Profile    │  │   Journey    │  │   Journal    │  │
│  │  Controller  │  │  Controller  │  │  Controller  │  │  Controller  │  │
│  └──────┬───────┘  └──────┬───────┘  └──────┬───────┘  └──────┬───────┘  │
│         │                  │                  │                  │           │
│         ▼                  ▼                  ▼                  ▼           │
│  ┌──────────────────────────────────────────────────────────────────────┐  │
│  │                        Service Layer                                  │  │
│  │  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐           │  │
│  │  │   Auth   │  │ Profile  │  │ Journey  │  │ Journal  │           │  │
│  │  │ Service  │  │ Service  │  │ Service  │  │ Service  │           │  │
│  │  └──────────┘  └──────────┘  └────┬─────┘  └──────────┘           │  │
│  │                                     │                                 │  │
│  │                                     │ Trigger n8n                     │  │
│  │                                     ▼                                 │  │
│  │                              ┌─────────────┐                         │  │
│  │                              │    n8n      │                         │  │
│  │                              │   Service   │                         │  │
│  │                              └─────────────┘                         │  │
│  └──────────────────────────────────────────────────────────────────────┘  │
│                                                                               │
│  ┌──────────────────────────────────────────────────────────────────────┐  │
│  │                      Integration Services                             │  │
│  │  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐           │  │
│  │  │ Pinecone │  │ MongoDB  │  │  Email   │  │  Drive   │           │  │
│  │  │ Service  │  │ Service  │  │ Service  │  │ Service  │           │  │
│  │  └──────────┘  └──────────┘  └──────────┘  └──────────┘           │  │
│  └──────────────────────────────────────────────────────────────────────┘  │
│                                                                               │
└───────────────────────────────────┬───────────────────────────────────────┘
                                    │
                    ┌───────────────┼───────────────┐
                    │               │               │
                    ▼               ▼               ▼
        ┌───────────────┐ ┌─────────────┐ ┌────────────────┐
        │   Supabase    │ │  Pinecone   │ │    MongoDB     │
        │  (Postgres)   │ │  (Vectors)  │ │   (Scripts)    │
        │               │ │             │ │                │
        │ - users       │ │ - user-info │ │ - drafts       │
        │ - profiles    │ │ - knowledge │ │ - sections     │
        │ - journeys    │ │ - creations │ │ - evaluations  │
        │ - journal     │ │ - trends    │ │                │
        │ - stats       │ │             │ │                │
        └───────────────┘ └─────────────┘ └────────────────┘


┌─────────────────────────────────────────────────────────────────────────────┐
│                         n8n WORKFLOW ORCHESTRATION                           │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                               │
│  ┌─────────────────────────────────────────────────────────────────┐        │
│  │  1. WEBHOOK TRIGGER                                              │        │
│  │     Receives: journeyId, userId, goal, intention, userProfile    │        │
│  └────────────────────────────┬─────────────────────────────────────┘        │
│                               │                                               │
│                               ▼                                               │
│  ┌─────────────────────────────────────────────────────────────────┐        │
│  │  2. STORE INITIAL DATA (MongoDB)                                 │        │
│  └────────────────────────────┬─────────────────────────────────────┘        │
│                               │                                               │
│                 ┌─────────────┴─────────────┐                                │
│                 │                           │                                 │
│                 ▼                           ▼                                 │
│  ┌──────────────────────────┐  ┌──────────────────────────┐                 │
│  │  BRANCH A:               │  │  BRANCH B:               │                 │
│  │  KNOWLEDGE BASE SEARCH   │  │  ONLINE RESEARCH         │                 │
│  │                          │  │                          │                 │
│  │  ┌────────────────────┐  │  │  ┌────────────────────┐ │                 │
│  │  │ Search Pinecone:   │  │  │  │ YouTube Search     │ │                 │
│  │  │ - User Info        │  │  │  │ (Top 5 videos)     │ │                 │
│  │  │ - Core Knowledge   │  │  │  └─────────┬──────────┘ │                 │
│  │  │ - Past Creations   │  │  │            │            │                 │
│  │  │ - Trends           │  │  │            ▼            │                 │
│  │  └─────────┬──────────┘  │  │  ┌────────────────────┐ │                 │
│  │            │              │  │  │ Download Videos    │ │                 │
│  │            ▼              │  │  │ (yt-dlp)           │ │                 │
│  │  ┌────────────────────┐  │  │  └─────────┬──────────┘ │                 │
│  │  │ Knowledge          │  │  │            │            │                 │
│  │  │ Extraction Agent   │  │  │            ▼            │                 │
│  │  │                    │  │  │  ┌────────────────────┐ │                 │
│  │  │ Sub-Agents:        │  │  │  │ Transcribe Videos  │ │                 │
│  │  │ - Structure        │  │  │  │ (Whisper API)      │ │                 │
│  │  │ - Keywords         │  │  │  └─────────┬──────────┘ │                 │
│  │  │ - Elements         │  │  │            │            │                 │
│  │  │ - Why It Works     │  │  │            ▼            │                 │
│  │  └─────────┬──────────┘  │  │  ┌────────────────────┐ │                 │
│  │            │              │  │  │ Reverse Engineer   │ │                 │
│  │            │              │  │  │ Agent              │ │                 │
│  │            │              │  │  │                    │ │                 │
│  │            │              │  │  │ Sub-Agents:        │ │                 │
│  │            │              │  │  │ - Structure        │ │                 │
│  │            │              │  │  │ - Keywords         │ │                 │
│  │            │              │  │  │ - Elements         │ │                 │
│  │            │              │  │  │ - Why It Works     │ │                 │
│  │            │              │  │  └─────────┬──────────┘ │                 │
│  └────────────┼──────────────┘  └────────────┼────────────┘                 │
│               │                               │                              │
│               └───────────┬───────────────────┘                              │
│                           │                                                  │
│                           ▼                                                  │
│  ┌─────────────────────────────────────────────────────────────────┐        │
│  │  5. MERGE KNOWLEDGE SOURCES                                      │        │
│  │     Combine & deduplicate insights from both branches            │        │
│  └────────────────────────────┬─────────────────────────────────────┘        │
│                               │                                               │
│                               ▼                                               │
│  ┌─────────────────────────────────────────────────────────────────┐        │
│  │  6. RATING & EVALUATION AGENT                                    │        │
│  │     Assess quality and suitability (0-10 scoring)                │        │
│  └────────────────────────────┬─────────────────────────────────────┘        │
│                               │                                               │
│                               ▼                                               │
│  ┌─────────────────────────────────────────────────────────────────┐        │
│  │  7. SCRIPT SUGGESTIONS AGENT                                     │        │
│  │     Generate 7-day journey arc and themes                        │        │
│  └────────────────────────────┬─────────────────────────────────────┘        │
│                               │                                               │
│                               ▼                                               │
│  ┌─────────────────────────────────────────────────────────────────┐        │
│  │  8. SCRIPT ELEMENTS AGENT                                        │        │
│  │     Create detailed blueprint for each day                       │        │
│  │     Sub-Agents: Structure, Keywords, Elements, Rationale         │        │
│  └────────────────────────────┬─────────────────────────────────────┘        │
│                               │                                               │
│                               ▼                                               │
│  ┌─────────────────────────────────────────────────────────────────┐        │
│  │  9. USER PERSONALIZATION AGENT                                   │        │
│  │     Deeply personalize blueprint to specific user                │        │
│  └────────────────────────────┬─────────────────────────────────────┘        │
│                               │                                               │
│                               ▼                                               │
│  ┌─────────────────────────────────────────────────────────────────┐        │
│  │  10. LOOP: 7 DAYS                                                │        │
│  │                                                                   │        │
│  │  FOR EACH DAY (1-7):                                             │        │
│  │                                                                   │        │
│  │  ┌────────────────────────────────────────────────────────────┐ │        │
│  │  │  10a. DRAFT CREATOR AGENT                                   │ │        │
│  │  │                                                              │ │        │
│  │  │  ┌──────────────────────────────────────────────────────┐  │ │        │
│  │  │  │ Intention & Calibration Sub-Agent  ──▶ MongoDB       │  │ │        │
│  │  │  └──────────────────────────────────────────────────────┘  │ │        │
│  │  │  ┌──────────────────────────────────────────────────────┐  │ │        │
│  │  │  │ Induction Sub-Agent  ──▶ MongoDB                     │  │ │        │
│  │  │  └──────────────────────────────────────────────────────┘  │ │        │
│  │  │  ┌──────────────────────────────────────────────────────┐  │ │        │
│  │  │  │ Deepener Sub-Agent  ──▶ MongoDB                      │  │ │        │
│  │  │  └──────────────────────────────────────────────────────┘  │ │        │
│  │  │  ┌──────────────────────────────────────────────────────┐  │ │        │
│  │  │  │ Suggestions Sub-Agent  ──▶ MongoDB                   │  │ │        │
│  │  │  └──────────────────────────────────────────────────────┘  │ │        │
│  │  │  ┌──────────────────────────────────────────────────────┐  │ │        │
│  │  │  │ Future Pacing Sub-Agent  ──▶ MongoDB                 │  │ │        │
│  │  │  └──────────────────────────────────────────────────────┘  │ │        │
│  │  │  ┌──────────────────────────────────────────────────────┐  │ │        │
│  │  │  │ Awakening Sub-Agent  ──▶ MongoDB                     │  │ │        │
│  │  │  └──────────────────────────────────────────────────────┘  │ │        │
│  │  └──────────────────────────┬───────────────────────────────┘ │        │
│  │                             │                                   │        │
│  │                             ▼                                   │        │
│  │  ┌────────────────────────────────────────────────────────────┐ │        │
│  │  │  10b. EVALUATOR AGENT                                      │ │        │
│  │  │       Score: Structure, Language, Elements,                │ │        │
│  │  │              Personalization, Flow                         │ │        │
│  │  │       Overall Score: 1-10                                  │ │        │
│  │  └──────────────────────┬─────────────────────────────────────┘ │        │
│  │                         │                                         │        │
│  │                         ▼                                         │        │
│  │                    ┌─────────┐                                    │        │
│  │                    │ Score?  │                                    │        │
│  │                    └────┬────┘                                    │        │
│  │                         │                                         │        │
│  │            ┌────────────┼────────────┐                            │        │
│  │            │            │            │                            │        │
│  │        < 8 │            │ ≥ 8        │                            │        │
│  │            │            │            │                            │        │
│  │            ▼            ▼            │                            │        │
│  │     ┌──────────┐  ┌──────────┐      │                            │        │
│  │     │ Loop     │  │ Continue │      │                            │        │
│  │     │ Back     │  │ to Audio │      │                            │        │
│  │     │ (Max 3x) │  │          │      │                            │        │
│  │     └────┬─────┘  └────┬─────┘      │                            │        │
│  │          │             │             │                            │        │
│  │          └─────────────┘             │                            │        │
│  │                                      │                            │        │
│  │                                      ▼                            │        │
│  │  ┌────────────────────────────────────────────────────────────┐ │        │
│  │  │  10c. AUDIO GENERATION                                      │ │        │
│  │  │                                                              │ │        │
│  │  │  ┌──────────────────────────────────────────────────────┐  │ │        │
│  │  │  │ Retrieve Sections from MongoDB                       │  │ │        │
│  │  │  └─────────────────────┬────────────────────────────────┘  │ │        │
│  │  │                        │                                    │ │        │
│  │  │                        ▼                                    │ │        │
│  │  │  ┌──────────────────────────────────────────────────────┐  │ │        │
│  │  │  │ FOR EACH SECTION:                                    │  │ │        │
│  │  │  │   - Generate Audio (ElevenLabs TTS)                  │  │ │        │
│  │  │  │   - Save temp file                                   │  │ │        │
│  │  │  └─────────────────────┬────────────────────────────────┘  │ │        │
│  │  │                        │                                    │ │        │
│  │  │                        ▼                                    │ │        │
│  │  │  ┌──────────────────────────────────────────────────────┐  │ │        │
│  │  │  │ Generate Background Sound                            │  │ │        │
│  │  │  │ (Ambient/Nature/Binaural)                            │  │ │        │
│  │  │  └─────────────────────┬────────────────────────────────┘  │ │        │
│  │  │                        │                                    │ │        │
│  │  │                        ▼                                    │ │        │
│  │  │  ┌──────────────────────────────────────────────────────┐  │ │        │
│  │  │  │ Merge Audio + Background (ffmpeg)                    │  │ │        │
│  │  │  └─────────────────────┬────────────────────────────────┘  │ │        │
│  │  │                        │                                    │ │        │
│  │  │                        ▼                                    │ │        │
│  │  │  ┌──────────────────────────────────────────────────────┐  │ │        │
│  │  │  │ Upload to Google Drive                               │  │ │        │
│  │  │  └─────────────────────┬────────────────────────────────┘  │ │        │
│  │  │                        │                                    │ │        │
│  │  │                        ▼                                    │ │        │
│  │  │  ┌──────────────────────────────────────────────────────┐  │ │        │
│  │  │  │ Update MongoDB with audio URL                        │  │ │        │
│  │  │  └──────────────────────────────────────────────────────┘  │ │        │
│  │  └────────────────────────────────────────────────────────────┘ │        │
│  │                                                                   │        │
│  │  END LOOP                                                         │        │
│  └───────────────────────────────┬───────────────────────────────────┘        │
│                                  │                                             │
│                                  ▼                                             │
│  ┌─────────────────────────────────────────────────────────────────┐        │
│  │  11. STORE COMPLETE JOURNEY (MongoDB)                            │        │
│  │      All 7 days with metadata                                    │        │
│  └────────────────────────────┬─────────────────────────────────────┘        │
│                               │                                               │
│                               ▼                                               │
│  ┌─────────────────────────────────────────────────────────────────┐        │
│  │  12. UPDATE PINECONE                                             │        │
│  │      Store creation in past-creations index                      │        │
│  └────────────────────────────┬─────────────────────────────────────┘        │
│                               │                                               │
│                               ▼                                               │
│  ┌─────────────────────────────────────────────────────────────────┐        │
│  │  13. SEND WEBHOOK TO BACKEND                                     │        │
│  │      POST /api/webhooks/n8n/journey-complete                     │        │
│  │      Payload: journeyId, userId, days[], metadata                │        │
│  └────────────────────────────┬─────────────────────────────────────┘        │
│                               │                                               │
│                               ▼                                               │
│  ┌─────────────────────────────────────────────────────────────────┐        │
│  │  14. SEND EMAIL TO USER                                          │        │
│  │      Gmail: "Your Journey is Ready!"                             │        │
│  │      Include: Journey overview, tips, dashboard link             │        │
│  └─────────────────────────────────────────────────────────────────┘        │
│                                                                               │
└─────────────────────────────────────────────────────────────────────────────┘


┌─────────────────────────────────────────────────────────────────────────────┐
│                         AI MODELS & SERVICES                                 │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                               │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐   │
│  │   OpenAI     │  │  Anthropic   │  │  DeepSeek    │  │   Cohere     │   │
│  │   GPT-4      │  │   Claude     │  │              │  │  Embeddings  │   │
│  │              │  │   Sonnet     │  │              │  │  (1024 dim)  │   │
│  │ - Knowledge  │  │              │  │              │  │              │   │
│  │   Extraction │  │ - Structure  │  │ - Why It     │  │ - Generate   │   │
│  │ - Keywords   │  │ - Elements   │  │   Works      │  │   vectors    │   │
│  │ - Script     │  │ - Evaluation │  │              │  │ - Search     │   │
│  │   Suggestions│  │ - Induction  │  │              │  │   queries    │   │
│  │ - Awakening  │  │ - Deepener   │  │              │  │              │   │
│  └──────────────┘  └──────────────┘  └──────────────┘  └──────────────┘   │
│                                                                               │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐   │
│  │ ElevenLabs   │  │   Whisper    │  │ Google APIs  │  │    Gmail     │   │
│  │     TTS      │  │ Transcription│  │              │  │              │   │
│  │              │  │              │  │ - YouTube    │  │ - Journey    │   │
│  │ - Voice      │  │ - Video to   │  │   Search     │  │   Ready      │   │
│  │   synthesis  │  │   text       │  │ - Drive      │  │ - Daily      │   │
│  │ - Section by │  │              │  │   Upload     │  │   Reminders  │   │
│  │   section    │  │              │  │              │  │              │   │
│  └──────────────┘  └──────────────┘  └──────────────┘  └──────────────┘   │
│                                                                               │
└─────────────────────────────────────────────────────────────────────────────┘


┌─────────────────────────────────────────────────────────────────────────────┐
│                         DATA FLOW SUMMARY                                    │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                               │
│  User Input (Frontend)                                                       │
│       │                                                                       │
│       ├─▶ Profile Data ──────────────────────▶ Supabase                     │
│       │                                                                       │
│       ├─▶ Onboarding Responses ──────────────▶ Supabase + Pinecone          │
│       │                                                                       │
│       └─▶ Journey Request ────────────────────▶ Backend API                 │
│                                                      │                        │
│                                                      ▼                        │
│                                              Trigger n8n Webhook             │
│                                                      │                        │
│                                                      ▼                        │
│                                              n8n Workflow                     │
│                                                      │                        │
│                    ┌─────────────────────────────────┼──────────┐           │
│                    │                                 │          │           │
│                    ▼                                 ▼          ▼           │
│            Search Pinecone                  Search YouTube   MongoDB        │
│            (User context)                   (Research)       (Staging)      │
│                    │                                 │          │           │
│                    └─────────────────────────────────┼──────────┘           │
│                                                      │                        │
│                                                      ▼                        │
│                                              AI Agent Processing             │
│                                              (15+ agents)                    │
│                                                      │                        │
│                                                      ▼                        │
│                                              Script Generation               │
│                                              (7 days × 6 sections)           │
│                                                      │                        │
│                                                      ▼                        │
│                                              MongoDB (Store scripts)         │
│                                                      │                        │
│                                                      ▼                        │
│                                              Audio Generation                │
│                                              (ElevenLabs TTS)                │
│                                                      │                        │
│                                                      ▼                        │
│                                              Google Drive (Store audio)      │
│                                                      │                        │
│                    ┌─────────────────────────────────┼──────────┐           │
│                    │                                 │          │           │
│                    ▼                                 ▼          ▼           │
│            Update Supabase              Update Pinecone    Send Email       │
│            (Journey ready)              (Store creation)   (User notify)    │
│                    │                                 │          │           │
│                    └─────────────────────────────────┼──────────┘           │
│                                                      │                        │
│                                                      ▼                        │
│                                              Frontend Dashboard              │
│                                              (User listens)                  │
│                                                                               │
└─────────────────────────────────────────────────────────────────────────────┘


┌─────────────────────────────────────────────────────────────────────────────┐
│                         DEPLOYMENT ARCHITECTURE                              │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                               │
│  ┌───────────────────────────────────────────────────────────────────────┐  │
│  │                          VERCEL (Frontend)                             │  │
│  │  ┌─────────────────────────────────────────────────────────────────┐  │  │
│  │  │  React + Vite Application                                        │  │  │
│  │  │  - Static assets served via CDN                                  │  │  │
│  │  │  - Automatic HTTPS                                               │  │  │
│  │  │  - Environment variables configured                              │  │  │
│  │  └─────────────────────────────────────────────────────────────────┘  │  │
│  └───────────────────────────────┬───────────────────────────────────────┘  │
│                                  │ HTTPS                                     │
│                                  ▼                                           │
│  ┌───────────────────────────────────────────────────────────────────────┐  │
│  │                         RAILWAY (Backend)                              │  │
│  │  ┌─────────────────────────────────────────────────────────────────┐  │  │
│  │  │  Node.js + Express API                                           │  │  │
│  │  │  - Auto-scaling                                                  │  │  │
│  │  │  - Health checks                                                 │  │  │
│  │  │  - Environment variables                                         │  │  │
│  │  │  - Automatic deployments                                         │  │  │
│  │  └─────────────────────────────────────────────────────────────────┘  │  │
│  └───────────────────────────────┬───────────────────────────────────────┘  │
│                                  │                                           │
│                                  ▼                                           │
│  ┌───────────────────────────────────────────────────────────────────────┐  │
│  │                      RAILWAY (n8n Instance)                            │  │
│  │  ┌─────────────────────────────────────────────────────────────────┐  │  │
│  │  │  n8n Workflow Engine                                             │  │  │
│  │  │  - Persistent storage                                            │  │  │
│  │  │  - Webhook endpoints                                             │  │  │
│  │  │  - Scheduled executions                                          │  │  │
│  │  └─────────────────────────────────────────────────────────────────┘  │  │
│  └───────────────────────────────────────────────────────────────────────┘  │
│                                                                               │
│  ┌────────────────┐  ┌────────────────┐  ┌────────────────┐                │
│  │   Supabase     │  │   Pinecone     │  │  MongoDB Atlas │                │
│  │   (Hosted)     │  │   (Hosted)     │  │    (Hosted)    │                │
│  └────────────────┘  └────────────────┘  └────────────────┘                │
│                                                                               │
│  ┌────────────────┐  ┌────────────────┐  ┌────────────────┐                │
│  │ Google Drive   │  │  Gmail SMTP    │  │  External APIs │                │
│  │  (Storage)     │  │  (Email)       │  │  (AI Models)   │                │
│  └────────────────┘  └────────────────┘  └────────────────┘                │
│                                                                               │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## Timing Breakdown

```
┌─────────────────────────────────────────────────────────────────┐
│                    WORKFLOW EXECUTION TIME                       │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  Phase 1: Setup & Data Gathering                (30-60 sec)     │
│    ├─ Webhook trigger & validation              (1 sec)         │
│    ├─ Store initial data                        (2 sec)         │
│    ├─ Search Pinecone (4 indices)               (10 sec)        │
│    ├─ YouTube search                             (5 sec)         │
│    ├─ Download videos (5 videos)                (20 sec)        │
│    └─ Transcribe videos (Whisper)               (30 sec)        │
│                                                                  │
│  Phase 2: AI Analysis & Planning                (60-90 sec)     │
│    ├─ Knowledge extraction agent                (20 sec)        │
│    ├─ Reverse engineering agent                 (20 sec)        │
│    ├─ Merge & evaluate                          (10 sec)        │
│    ├─ Script suggestions                        (15 sec)        │
│    ├─ Script elements                           (15 sec)        │
│    └─ Personalization                           (10 sec)        │
│                                                                  │
│  Phase 3: Script Generation (7 days)            (3-5 min)       │
│    └─ Per Day:                                  (25-45 sec)     │
│        ├─ Intention & Calibration               (5 sec)         │
│        ├─ Induction                             (8 sec)         │
│        ├─ Deepener                              (5 sec)         │
│        ├─ Suggestions                           (10 sec)        │
│        ├─ Future Pacing                         (5 sec)         │
│        ├─ Awakening                             (3 sec)         │
│        └─ Evaluation                            (5 sec)         │
│                                                                  │
│  Phase 4: Audio Generation (7 days)             (2-3 min)       │
│    └─ Per Day:                                  (15-25 sec)     │
│        ├─ Retrieve sections                     (1 sec)         │
│        ├─ Generate audio (6 sections)           (10 sec)        │
│        ├─ Generate background                   (2 sec)         │
│        ├─ Merge audio                           (5 sec)         │
│        ├─ Upload to Drive                       (5 sec)         │
│        └─ Update MongoDB                        (1 sec)         │
│                                                                  │
│  Phase 5: Finalization                          (15-30 sec)     │
│    ├─ Store complete journey                    (3 sec)         │
│    ├─ Update Pinecone                           (5 sec)         │
│    ├─ Send webhook to backend                   (2 sec)         │
│    └─ Send email                                (3 sec)         │
│                                                                  │
│  ═══════════════════════════════════════════════════════════    │
│  TOTAL ESTIMATED TIME:                          5-10 minutes    │
│  ═══════════════════════════════════════════════════════════    │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

---

## Error Handling Flow

```
┌─────────────────────────────────────────────────────────────────┐
│                      ERROR HANDLING                              │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  Any Node                                                        │
│      │                                                           │
│      │ Error Occurs                                             │
│      ▼                                                           │
│  ┌──────────────┐                                               │
│  │ Error Trigger│                                               │
│  └──────┬───────┘                                               │
│         │                                                        │
│         ├─▶ Log Error to MongoDB                                │
│         │   (workflow_logs collection)                          │
│         │                                                        │
│         ├─▶ Update Journey Status                               │
│         │   (status = 'error')                                  │
│         │                                                        │
│         ├─▶ Send Webhook to Backend                             │
│         │   POST /api/webhooks/n8n/error                        │
│         │   { journeyId, error, timestamp }                     │
│         │                                                        │
│         ├─▶ Notify Admin                                        │
│         │   Email with error details                            │
│         │                                                        │
│         └─▶ (Optional) Notify User                              │
│             Apologetic email with support contact               │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

---

**Document Version**: 1.0  
**Last Updated**: November 8, 2025  
**Owner**: Max Mayes

